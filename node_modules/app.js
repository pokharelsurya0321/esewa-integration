const express = require('express');
const axios = require('axios');
const app = express();
const port = 3000;

// Endpoint to initiate payment
app.get('/payment', async (req, res) => {
  try {
    // Set up the eSewa API endpoint
    const apiUrl = 'https://uat.esewa.com.np/epay/main';
    const data = {
      amt: 100, // Payment amount
      psc: 0, // Service charge
      pdc: 0, // Delivery charge
      txAmt: 0, // Tax amount
      tAmt: 100, // Total amount
      pid: 'EPAYTEST', // Unique payment ID
      su: 'http://your-website.com/success', // Success URL
      fu: 'http://your-website.com/failure', // Failure URL
    };

    // Send a POST request to the eSewa API
    const response = await axios.post(apiUrl, data);

    // Redirect the user to the eSewa payment page
    res.redirect(response.data);
  } catch (error) {
    console.error('Error initiating payment:', error);
    res.status(500).send('Error initiating payment');
  }
});

// Endpoint for success callback from eSewa
app.get('/success', (req, res) => {
  // Payment was successful
  res.send('Payment successful!');
});

// Endpoint for failure callback from eSewa
app.get('/failure', (req, res) => {
  // Payment was not successful
  res.send('Payment failed!');
});

// Start the server
app.listen(port, () => {
  console.log(`Server is running on port ${port}`);
});
